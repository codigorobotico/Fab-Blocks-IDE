<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Visualino - RoboBlocks PlayGround</title>
    <link rel="stylesheet" type="text/css" href="visualino.css">
    <link rel="stylesheet" type="text/css" href="javascript/highlight/styles/default.css">
</head>
<body>
    <xml id="startBlocks" style="display: none">
        <block type="controls_setupLoop" deletable="false"></block>
    </xml>
    <div id="wrap">
        <div id="blockly" style="float: left; width: 66%;"></div>
        <div id="code" style="float: right; width: 34%;"></div>
    </div>
    <script src="javascript/jquery/dist/jquery.min.js"></script>
    <script src="javascript/underscore/underscore.js"></script>
    <script src="javascript/highlight/highlight.pack.js"></script>
    <script src="javascript/blockly-bq/blockly_compressed.js"></script>
    <script src="javascript/blockly-bq/blocks_compressed.js"></script>
    <script src="javascript/blockly-bq/arduino_compressed.js"></script>
    <script src="roboblocks.js"></script>
    <script>
            if (window.roboblocksLanguage === undefined
                || window.roboblocksLanguage == null) {
                var roboblocksLanguage = 'en-GB';
            }

            RoboBlocks.load({
                zoom: 0.5
            });

            // New workspace for each test case
            var el = document.getElementById('blockly');
            Blockly.inject(el, {
                toolbox: Blockly.createToolbox()
            });
            // Create a default setup/loop block
            Blockly.Xml.domToWorkspace(Blockly.getMainWorkspace(),
                document.getElementById('startBlocks'));

            $('.blocklySvg, #blockly').height('100%');
            $('.blocklySvg').width('100%');

            var colors = [
                "",
                RoboBlocks.LANG_COLOUR_PROCEDURES,
                RoboBlocks.LANG_COLOUR_CONTROL,
                RoboBlocks.LANG_COLOUR_LOGIC,
                RoboBlocks.LANG_COLOUR_MATH,
                RoboBlocks.LANG_COLOUR_VARIABLES,
                RoboBlocks.LANG_COLOUR_TEXT,
                RoboBlocks.LANG_COLOUR_COMMUNICATION,
                RoboBlocks.LANG_COLOUR_MODULAR,
                RoboBlocks.LANG_COLOUR_ZUM,
                RoboBlocks.LANG_COLOUR_BQ,
                RoboBlocks.LANG_COLOUR_ADVANCED,
                RoboBlocks.LANG_COLOUR_LCD,
                RoboBlocks.LANG_COLOUR_SERVO,
            ];
            $('.blocklyTreeRow').each( function (i,e) {
                $(e).prepend('<span class="treeLabelBlock" style="background-color:' + colors[i] + '"></span>');
            });

            // Update code
            Blockly.addChangeListener(function () {
                $('#code').html('<code class="c++"><pre>'
                    + escapeCode(Blockly.Arduino.workspaceToCode())
                    + '</pre></code>');
                // Highlight
                $("pre").each(function (i, e) {
                  hljs.highlightBlock(e);
                });
            });

            // Show/hide code
            function toogleCode() {
                if ($('#code').css('display') == 'none') {
                    // Show
                    $('#code').show();
                    $('#blockly').width('66%');
                } else {
                    // Hide
                    $('#code').hide();
                    $('#blockly').width('100%');
                }
                // Resize workspace
                Blockly.fireUiEvent(window, "resize");
            }

            function escapeCode(code) {
                var str = code;
                str = str.replace(/</g, "&lt;");
                str = str.replace(/>/g, "&gt;");
                return str;
            }

            function resetWorkspace() {
                Blockly.mainWorkspace.clear();
                Blockly.Xml.domToWorkspace(Blockly.getMainWorkspace(),
                    document.getElementById('startBlocks'));
            }

    </script>
    <button onclick="loadExample('custom_example')">Cargar Ejemplo Personalizado</button>
    <script>
        // Define la funci√≥n para cargar ejemplos
        function loadExample(exampleName) {
            // Define el XML del ejemplo personalizado
            var customExampleXML = '<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_setupLoop" id="2" x="11" y="17"><statement name="SETUP"><block type="bq_led_2" id="21"><field name="VAR">name</field><field name="MOD">0</field><field name="PORT">0</field></block></statement><statement name="LOOP"><block type="inout_digital_write" id="3" inline="true"><field name="STAT">HIGH</field><value name="PIN"><block type="math_number" id="4"><field name="NUM">12</field></block></value><next><block type="test_inout_digital_write" id="32"><field name="VAR"> </field><field name="STAT">HIGH</field><next><block type="base_delay" id="5" inline="true"><value name="DELAY_TIME"><block type="math_number" id="6"><field name="NUM">500</field></block></value><next><block type="inout_digital_write" id="7" inline="true"><field name="STAT">LOW</field><value name="PIN"><block type="math_number" id="8"><field name="NUM">12</field></block></value><next><block type="base_delay" id="9" inline="true"><value name="DELAY_TIME"><block type="math_number" id="10"><field name="NUM">500</field></block></value></block></next></block></next></block></next></block></next></block></statement></block></xml>';

            // Limpia el espacio de trabajo de Blockly
            Blockly.mainWorkspace.clear();
            // Carga el XML del ejemplo personalizado en el espacio de trabajo de Blockly
            Blockly.Xml.domToWorkspace(Blockly.getMainWorkspace(), Blockly.Xml.textToDom(customExampleXML));
        }
    </script>
</body>
</html>
